# Design: RF001 - RF001 - Technical Design & Architecture

**Requirement**: RF001
**Card ID**: PROD-001
**Squad**: Arquitetura
**Created**: 2025-12-26 20:39:28
**Version**: 1.0.0

---

## 1. Overview

Create detailed technical design for Gerenciamento de Oráculos

**User Story**: As a Tech Lead, I want to design the architecture for Gerenciamento de Oráculos

**Business Value**: Ensures correct implementation

---

## 2. Technical Approach

### 2.1 Layer Assignment

**Primary Layer**: Camada 1 - Oráculo

**Rationale**: This requirement involves core business logic and domain knowledge management, placing it in Layer 1 (Oráculo).

### 2.2 Technology Stack

- **Backend**: FastAPI (Python) for rapid API development
- **Database**: PostgreSQL for structured data, NebulaGraph for knowledge relationships
- **Frontend**: Next.js 14 with App Router
- **Caching**: Redis for performance optimization
- **AI/LLM**: LangChain for RAG pipelines

**Technology Choices Based On**:
- ADR-003: PostgreSQL + NebulaGraph Híbrido
- ADR-004: CrewAI + LangGraph
- ADR-005: Next.js 14 App Router
- ADR-006: Go para Backend Core (optional for high-performance services)

### 2.3 Architectural Patterns

- **Metadata-Driven Architecture** (ADR-001): Use `object_definitions` to define entities
- **Event Sourcing**: Track all changes for auditability
- **CQRS**: Separate read and write models for scalability

---

## 3. Data Model

### 3.1 Database Tables

See: `schemas/rf001-schema.sql`

**Primary Entities**:
- `oracles` (if applicable)
- `object_definitions` (metadata)
- `instances` (actual data)

### 3.2 Relationships

- Multi-tenancy via `oracle_id` foreign key (ADR-007)
- Relationships tracked in NebulaGraph
- JSON Schema validation for dynamic fields

---

## 4. API Design

### 4.1 Endpoints

See: `api-contracts/rf001-api.yaml`

**Expected Endpoints** (based on CRUD pattern):
- `POST /api/v1/oracles` - Create oracle
- `GET /api/v1/oracles` - List oracles
- `GET /api/v1/oracles/{id}` - Get oracle details
- `PUT /api/v1/oracles/{id}` - Update oracle
- `DELETE /api/v1/oracles/{id}` - Delete oracle

### 4.2 Authentication/Authorization

- **JWT Tokens**: Required for all endpoints
- **Multi-Tenancy**: Filter by `oracle_id` automatically
- **RBAC**: Role-based access control

---

## 5. Integration Points

### 5.1 Internal Services

- **Knowledge Graph Service**: Query domain knowledge from NebulaGraph
- **RAG Service**: Semantic search over documentation
- **Event Bus**: Publish events for state changes

### 5.2 External Dependencies

- None for this requirement (internal-only)

---

## 6. Architecture Diagrams

### 6.1 C4 Context Diagram
See: `diagrams/diagram-RF001-c4-context.mermaid`

### 6.2 ERD (if applicable)
See: `diagrams/diagram-RF001-erd.mermaid`

---

## 7. Implementation Guidance

### 7.1 Backend Implementation

**File Structure**:
```
backend/
├── services/
│   └── oracle_service.py
├── models/
│   └── oracle.py
├── api/
│   └── v1/
│       └── oracles.py
└── tests/
    └── test_oracle_service.py
```

**Key Classes**:
- `OracleService`: Business logic
- `OracleModel`: Database model (SQLAlchemy)
- `OracleAPI`: FastAPI router

**Database Migrations**:
- Use Alembic for PostgreSQL migrations
- Version control all schema changes

### 7.2 Frontend Implementation

**Components**:
- `OracleList.tsx`: List view
- `OracleForm.tsx`: Create/Edit form
- `OracleDetail.tsx`: Detail view

**Pages**:
- `/oracles` - List page
- `/oracles/new` - Create page
- `/oracles/[id]` - Detail page
- `/oracles/[id]/edit` - Edit page

**State Management**:
- React Server Components (Next.js 14)
- SWR for data fetching

### 7.3 Testing Strategy

**Unit Tests** (≥80% coverage):
- Service layer logic
- API endpoint handlers
- Frontend components

**Integration Tests**:
- API integration with database
- Frontend integration with backend API

**E2E Tests** (Playwright):
- User flow: Create oracle → List oracles → Edit oracle → Delete oracle

---

## 8. Acceptance Criteria

- [x] Technical design document created covering Camada 1 - Oráculo
- [x] Architecture diagrams (Mermaid) created
- [x] API contracts defined
- [x] Database schema designed
- [x] Integration points identified

---

## 9. References

**ADRs Referenced**:
- ADR-001: Metadata-Driven Architecture
- ADR-003: PostgreSQL + NebulaGraph
- ADR-005: Next.js 14 App Router
- ADR-007: Multi-Tenancy via oracle_id

**Related Requirements**: RF001

**Stack Documentation**: See `stack_supercore_v2.0.md`

---

**Generated by**: Architecture Owner Agent v1.0.0
**Date**: 2025-12-26T20:39:28.708857
