{
  "name": "conta_corrente_pf",
  "display_name": "Conta Corrente Pessoa Física",
  "description": "Conta corrente para pessoas físicas com todas as validações BACEN",
  "category": "BUSINESS_ENTITY",
  "schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "required": ["cpf", "nome_completo", "data_nascimento", "email", "telefone"],
    "properties": {
      "cpf": {
        "type": "string",
        "pattern": "^\\d{11}$",
        "description": "CPF do titular (11 dígitos)"
      },
      "nome_completo": {
        "type": "string",
        "minLength": 3,
        "maxLength": 200,
        "description": "Nome completo do titular"
      },
      "data_nascimento": {
        "type": "string",
        "format": "date",
        "description": "Data de nascimento (YYYY-MM-DD)"
      },
      "email": {
        "type": "string",
        "format": "email",
        "description": "E-mail do titular"
      },
      "telefone": {
        "type": "string",
        "pattern": "^\\d{11}$",
        "description": "Telefone celular com DDD (11 dígitos)"
      },
      "saldo": {
        "type": "number",
        "minimum": 0,
        "description": "Saldo atual da conta"
      },
      "numero_conta": {
        "type": "string",
        "pattern": "^\\d{1,13}$",
        "description": "Número da conta"
      },
      "agencia": {
        "type": "string",
        "pattern": "^\\d{4}$",
        "description": "Código da agência (4 dígitos)"
      },
      "tipo_conta": {
        "type": "string",
        "enum": ["CORRENTE", "POUPANCA", "SALARIO"],
        "description": "Tipo de conta"
      }
    }
  },
  "rules": [
    {
      "field": "cpf",
      "validation_rule_name": "cpf_digits",
      "error_message": "CPF inválido"
    },
    {
      "field": "data_nascimento",
      "validation_rule_name": "age_min_18",
      "error_message": "Titular deve ter pelo menos 18 anos"
    },
    {
      "field": "email",
      "validation_rule_name": "email_format",
      "error_message": "E-mail inválido"
    },
    {
      "field": "telefone",
      "validation_rule_name": "phone_mobile_br",
      "error_message": "Telefone celular inválido"
    }
  ],
  "states": {
    "initial": "DRAFT",
    "states": [
      "DRAFT",
      "PENDING_APPROVAL",
      "ACTIVE",
      "SUSPENDED",
      "CLOSED"
    ],
    "transitions": [
      {
        "from": "DRAFT",
        "to": "PENDING_APPROVAL",
        "condition": "all_validations_pass"
      },
      {
        "from": "PENDING_APPROVAL",
        "to": "ACTIVE",
        "condition": "kyc_approved"
      },
      {
        "from": "PENDING_APPROVAL",
        "to": "DRAFT",
        "condition": "kyc_rejected"
      },
      {
        "from": "ACTIVE",
        "to": "SUSPENDED",
        "condition": null
      },
      {
        "from": "SUSPENDED",
        "to": "ACTIVE",
        "condition": "suspension_lifted"
      },
      {
        "from": "ACTIVE",
        "to": "CLOSED",
        "condition": "zero_balance"
      },
      {
        "from": "SUSPENDED",
        "to": "CLOSED",
        "condition": "zero_balance"
      }
    ]
  },
  "ui_hints": {
    "form_layout": "vertical",
    "field_order": [
      "cpf",
      "nome_completo",
      "data_nascimento",
      "email",
      "telefone",
      "tipo_conta",
      "agencia",
      "numero_conta"
    ],
    "field_groups": [
      {
        "label": "Dados Pessoais",
        "fields": ["cpf", "nome_completo", "data_nascimento"]
      },
      {
        "label": "Contato",
        "fields": ["email", "telefone"]
      },
      {
        "label": "Dados Bancários",
        "fields": ["tipo_conta", "agencia", "numero_conta"]
      }
    ],
    "field_widgets": {
      "cpf": {
        "widget": "masked-input",
        "mask": "###.###.###-##"
      },
      "data_nascimento": {
        "widget": "date-picker",
        "max_date": "today-18years"
      },
      "telefone": {
        "widget": "masked-input",
        "mask": "(##) #####-####"
      },
      "tipo_conta": {
        "widget": "select"
      },
      "agencia": {
        "widget": "masked-input",
        "mask": "####"
      }
    },
    "conditional_fields": [
      {
        "field": "saldo",
        "show_when": {
          "field": "tipo_conta",
          "operator": "equals",
          "value": "POUPANCA"
        }
      }
    ]
  },
  "relationships": [
    {
      "type": "OWNED_BY",
      "target_object_definition": "cliente_pf",
      "cardinality": "many-to-one",
      "required": true
    },
    {
      "type": "HAS_TRANSACTION",
      "target_object_definition": "transacao",
      "cardinality": "one-to-many",
      "required": false
    }
  ]
}
